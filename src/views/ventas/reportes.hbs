<div class="container py-3 pr-0 pl-0">
    <form id="filtros" class="form" role="form" autocomplete="off" method="POST">
        <div class="card text-center">
            <div class="card-header">
                <div class="row">
                    <div class="col-11">
                        <ul class="nav nav-tabs w-100 justify-content-center" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="fecha-tab" data-toggle="tab" href="#fecha" role="tab"
                                    aria-controls="fecha" aria-selected="true">Única fecha</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="mfechas-tab" data-toggle="tab" href="#mfechas" role="tab"
                                    aria-controls="mfechas" aria-selected="false">Multiples fechas</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="reparto-tab" data-toggle="tab" href="#reparto" role="tab"
                                    aria-controls="reparto" aria-selected="false">Reparto</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="cliente-tab" data-toggle="tab" href="#clienteReport" role="tab"
                                    aria-controls="clienteReport" aria-selected="false">Por cliente</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-1">
                        <a href="/ventas" role="button" id="sidebarCollapse" class="btn btn-secondary p-1">
                            <svg aria-hidden="true" focusable="false" data-prefix="far"
                                data-icon="arrow-alt-circle-left"
                                class="svg-inline--fa fa-arrow-alt-circle-left fa-w-16" height="24" width="24"
                                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <path fill="currentColor"
                                    d="M8 256c0 137 111 248 248 248s248-111 248-248S393 8 256 8 8 119 8 256zm448 0c0 110.5-89.5 200-200 200S56 366.5 56 256 145.5 56 256 56s200 89.5 200 200zm-72-20v40c0 6.6-5.4 12-12 12H256v67c0 10.7-12.9 16-20.5 8.5l-99-99c-4.7-4.7-4.7-12.3 0-17l99-99c7.6-7.6 20.5-2.2 20.5 8.5v67h116c6.6 0 12 5.4 12 12z">
                                </path>
                            </svg>
                            <span></span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="fecha" role="tabpanel" aria-labelledby="fecha-tab">
                        <div class="form-row align-items-center justify-content-center">
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInput" class="mx-auto">Fecha:</label>
                                    <input class="form-control" type="date" name="dateInput" id="dateInput">
                                </div>
                            </div>
                            <div class="col-auto">
                                <button type="button" data-toggle="modal" data-target="#modalAlert"
                                    onclick="ajaxRequest('Fecha')" class="btn btn-primary mt-3">Generar</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="mfechas" role="tabpanel" aria-labelledby="mfechas-tab">
                        <div class="form-row align-items-center justify-content-center">
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInputS_mf" class="mx-auto">Desde:</label>
                                    <input class="form-control" type="date" name="dateInputS_mf" id="dateInputS_mf">
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInputE_mf" class="mx-auto">Hasta:</label>
                                    <input class="form-control" type="date" name="dateInputE_mf" id="dateInputE_mf">
                                </div>
                            </div>
                            <div class="col-auto">
                                <!---->
                                <button type="button" data-toggle="modal" data-target="#modalAlert"
                                    onclick="ajaxRequest('MFechas')" class="btn btn-primary mt-3">Generar</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="reparto" role="tabpanel" aria-labelledby="reparto-tab">
                        <div class="form-row align-items-center justify-content-center">
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dia" class="mx-auto">Dia:</label>
                                    <select id="dia" name="dia" class="form-control">
                                        <option selected disabled value="0" style="display:none;">Día
                                        </option>
                                        {{#each dias}}
                                        <option value="{{toJSON this}}">{{dia}}</option>
                                        {{/each}}
                                    </select>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="usuario" class="mx-auto">Reparto:</label>
                                    <select id="usuario" name="usuario" class="form-control">
                                        <option selected disabled value="0" style="display:none;">Reparto
                                        </option>
                                        {{#each usuarios}}
                                        <option value="{{toJSON this}}">{{reparto}}</option>
                                        {{/each}}
                                    </select>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="turno" class="mx-auto">Turno:</label>
                                    <select id="turno" name="turno" class="form-control">
                                        <option selected disabled value="0" style="display:none;">Turno
                                        </option>
                                        {{#each turnos}}
                                        <option value="{{toJSON this}}">{{turno}}</option>
                                        {{/each}}
                                    </select>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInputS" class="mx-auto">Desde:</label>
                                    <input class="form-control" type="date" name="dateInputS" id="dateInputS">
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInputE" class="mx-auto">Hasta:</label>
                                    <input class="form-control" type="date" name="dateInputE" id="dateInputE">
                                </div>
                            </div>
                            <div class="col-auto">
                                <button type="button" data-toggle="modal" data-target="#modalAlert"
                                    onclick="ajaxRequest('Reparto')" class="btn btn-primary mt-3">Generar</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="clienteReport" role="tabpanel" aria-labelledby="cliente-tab">
                        <div class="form-row align-items-center justify-content-center">
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="searchInput" class="mx-auto">Cliente:</label>
                                    <div class="input-group ">
                                        <div class="input-group-prepend">
                                            <button class="btn btn-secondary" type="button" id="dropdownMenuButton"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span id="filterId">Filtro</span> <i class="fas fa-angle-down"></i>
                                            </button>
                                            <div class="dropdown-menu" id="DropClient"
                                                aria-labelledby="dropdownMenuButton">
                                                {{#each clientesKeys}}
                                                <a data-Key={{this}} style="cursor: pointer;"
                                                    onclick="llenarInput(this);" class="dropdown-item">{{this}}</a>
                                                {{/each}}
                                            </div>
                                        </div>

                                        <input type="text" class="form-control selector"
                                            aria-label="Text input with dropdown button" id="searchInput">
                                    </div>
                                </div>
                                <input id="clientHelp_c" name="clientHelp_c" class="d-none"></input>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInputS_c" class="mx-auto">Desde:</label>
                                    <input class="form-control" type="date" name="dateInputS_c" id="dateInputS_c">
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="dateInputE_c" class="mx-auto">Hasta:</label>
                                    <input class="form-control" type="date" name="dateInputE_c" id="dateInputE_c">
                                </div>
                            </div>
                            <div class="col-auto">
                                <!---->
                                <button type="button" data-toggle="modal" data-target="#modalAlert"
                                    onclick="ajaxRequest('Cliente')" class="btn btn-primary mt-3">Generar</button>
                            </div>
                        </div>
                    </div>
                    <div id="salesInfoMap" class="form-row align-items-center justify-content-center">
                    </div>
                </div>

            </div>
        </div>

    </form>
</div>
<div id="toolbar1">
    <button type="button" class="btn btn-primary"
        onclick="displayChart({type:'bar',focus:'Cantidad Vendida',fill:false},window.chart)" data-toggle="modal"
        data-target="#exampleModalCenter">
        Cantidad Vendida
    </button>
    <button type="button" class="btn btn-primary"
        onclick="displayChart({type:'line',focus:'Ventas por dia',fill:false},window.chart)" data-toggle="modal"
        data-target="#exampleModalCenter">
        Ventas por día
    </button>
    <button type="button" class="btn btn-primary" onclick="getProductSaleReport();">
        Generar reporte de Ventas
    </button>
</div>
<div class="reports">
    <table ref="mainTable" class="table table-striped table-bordered table-hover" data-detail-view="true"
        data-toolbar="#toolbar1" id="mainTable" data-show-toggle="true" data-show-columns="true"
        data-show-fullscreen="true" data-locale="es_ES" data-row-style="rowStyle" data-filter-control="true"
        data-show-footer="true">
        <thead>
            <tr>
                <th data-field="state" data-checkbox="true" data-halign="center" data-align="center"></th>
                <th data-field="codigo" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center"># Cliente</th>
                <th data-field="nombre" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center">Nombre</th>
                <th data-field="ciudad" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center">Ciudad</th>
                <th data-field="usuario" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center">Usuario</th>
                <th data-field="turno" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center">Turno</th>
                <th data-field="fecha" data-sortable="true" data-filter-control="select" data-formatter="dateFormatter"
                    data-halign="center" data-align="center">Fecha</th>
                <th data-field="hora" data-sortable="true" data-filter-control="select"
                    data-footer-formatter="totalFormatter" data-halign="center" data-align="center">
                    Hora</th>
                <th data-field="items" data-sortable="true" data-footer-formatter="cantFormatter" data-halign="center"
                    data-align="center">Items</th>
                <th data-field="monto" data-sortable="true" data-formatter="priceFormatter"
                    data-footer-formatter="importFormatter" data-halign="center" data-align="center">Monto</th>
                <th data-field="detalle" data-visible="false"></th>
                <th data-field="causa" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center" data-visible="false">Causa</th>
                <th data-field="observacion" data-sortable="true" data-filter-control="select" data-halign="center"
                    data-align="center" data-visible="false">Observaciones</th>
            </tr>
        </thead>
    </table>
</div>

<!-- Modal ALERT -->
<div class="modal fade" data-backdrop="static" data-keyboard="false" id="modalAlert" tabindex="-1" role="dialog"
    aria-labelledby="modalAlert" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Alerta</h5>
                <button type="button" class="close d-none" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert" id="alerta" role="alert"></div>
                <div class="text-center" id="spinner" style="display: none;">
                    <div class="spinner-border spinner-border-lg" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="alertFoot">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn-confirm">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title w-100 text-center" id="exampleModalLongTitle">Consulta</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <canvas id="myChart"></canvas>
            </div>
            <div class="modal-footer d-none">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="hideMap" class="modalNew">
    <span onclick="document.getElementById('hideMap').style.display='none'; map.getViewPort().resize();"
        class="closeNew" title="Close Modal">&times;</span>
    <form class="modal-contentNew">
        <div class="bg-light px-5 py-2">
            <div id="panel" style="font-size: 1.5rem;"></div>
            <div id="map" class="m-auto" style="width: 100%;height: 80vh;z-index: 99;"></div>

        </div>
    </form>
</div>

<div class="modal fade" id="ModalCenterSale" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalLongTitle">Venta</h5>
                <button type="button" onclick="resetSaleForm()" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <h6 class="modal-title mx-auto" id="ModalLongTitle">
                <h5 id="clientHelp" class="form-text text-muted text-center">No hay datos aún</h5>
            </h6>
            <div class="modal-body">
                <form class="form mb-0" id="saleForm" role="form" autocomplete="off" action="" method="POST">
                    <input type="hidden" class="form-control selector" name="clienteModificar" id="clienteModificar">
                    <div id="dateTimeSale" class="form-row justify-content-center mb-1">
                        <div class="col-auto text-center px-0 mr-1">
                            <label for="date-input" class="mx-auto mb-0">Fecha</label>
                            <input class="form-control form-control" type="date" id="date-input">
                        </div>
                        <div class="col-auto text-center px-0 ml-1">
                            <label for="time-input" class="mx-auto mb-0">Hora</label>
                            <input class="form-control form-control" step="1" type="time" id="time-input">
                        </div>
                    </div>
                    <div class="row mb-0" id="saleProduct">
                        <div class="form-group col-8 pr-1">
                            <div class="custom-control custom-checkbox">
                                <input onclick="changeAutocomple();" type="checkbox" class="custom-control-input pr-0"
                                    id="checkProd" checked>
                                <label class="custom-control-label mb-0 pl-0" for="checkProd">Producto - <b
                                        id="autocompletarProd"> Código </b> </label>
                            </div>
                            <div class="input-group">
                                <input type="number" class="form-control selector"
                                    aria-label="Seleccione un producto..." id="Prod" value="" name="Producto"
                                    data-prod="{{toJSON Productos}}">
                                <div class="input-group-append">
                                    <span class="input-group-text" id="precioProd">$0</span>
                                </div>
                            </div>
                            <small id="prodHelp" class="form-text text-muted text-center">No hay datos
                                aún</small>
                        </div>
                        <div class="form-group col-3">
                            <label for="Cantidad" class="mb-0">Cantidad</label>
                            <div class="row">
                                <div class="col-8 pl-1 pr-1">
                                    <input name="Cantidad" type="number" id='Cant' class="form-control" min="0"
                                        step="1">
                                </div>
                                <div class="col-2 pl-1">
                                    <button name="addButton" id="addButton" type="button"
                                        class="btn btn-outline-success "><svg width="1em" height="1em"
                                            viewBox="0 0 16 16" class="bi bi-cart-plus-fill" fill="currentColor"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd"
                                                d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zM4 14a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm7 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9V5.5z" />
                                        </svg></button>
                                </div>
                            </div>
                        </div>

                    </div>
                </form>
                <div id="toolbar2">
                </div>
                <div class="reports">
                    <table class="table" id="tableSale" data-toolbar="#toolbar2" data-search="false"
                        data-show-refresh="false" data-show-toggle="true" data-show-fullscreen="true"
                        data-show-columns-toggle-all="true" data-detail-view="false" data-show-export="false"
                        data-single-select="true" data-click-to-select="true" data-detail-formatter="detailFormatter"
                        data-minimum-count-columns="2" data-show-pagination-switch="false" data-pagination="false"
                        data-id-field="id" data-show-footer="true" data-response-handler="responseHandler">
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ModalNoSale" tabindex="-1" role="dialog" aria-labelledby="modifyModalTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modifyModalLongTitle">No venta</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="NoSale">
                <div class="modal-body">
                    <h6 class="modal-title mx-auto" id="ModalLongTitle">
                        <h5 id="clientHelp-ns" class="form-text text-muted text-center">No hay datos aún</h5>
                    </h6>
                    <div class="form-group">
                        <label for="causas-ns" class="mx-auto mb-0">Causa</label>
                        <select class="form-control" id="causas-ns" disabled>
                            <option disabled selected></option>
                            <option value="Local Cerrado">Local cerrado</option>
                            <option value="No demanda">No demanda</option>
                            <option value="Otro problema">Otro problema</option>
                        </select>
                    </div>
                    <div id="dateTimeSale" class="form-row justify-content-center mb-1">
                        <div class="col-auto text-center px-0 mr-1">
                            <label for="date-input-ns" class="mx-auto mb-0">Fecha</label>
                            <input class="form-control form-control" type="date" id="date-input-ns" disabled>
                        </div>
                        <div class="col-auto text-center px-0 ml-1">
                            <label for="time-input-ns" class="mx-auto mb-0">Hora</label>
                            <input class="form-control form-control" step="1" type="time" id="time-input-ns" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="obs-ns">Observacion</label>
                        <textarea class="form-control" id="obs-ns" rows="3" disabled></textarea>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="/js/moment-with-locales.min.js.js"></script>
<script>
    window.addEventListener('resize', function () {
        map.getViewPort().resize();
    });

    function displayItineraryOnMap(destinos) {
        document.getElementById('hideMap').style.display = 'block';
        map.getViewPort().resize();
        //console.log(destinos);
        displayRoutes(destinos);
    }

    function displayMarkersOnMap(destinos) {
        document.getElementById('hideMap').style.display = 'block';
        map.getViewPort().resize();
        //console.log(destinos);
        displayMarkers(destinos);
    }
    window.clientsData = {{{clientesData}}};

    window.onload = llenarInput($("#DropClient")[0].children[0]);
    function llenarInput(elemento) {
        $("#filterId").text(elemento.getAttribute("data-Key"));
        $('.dropdown-item').removeClass('active');
        $(elemento).addClass('active');
        document.getElementById("searchInput").value = "";
        const keyName = elemento.getAttribute("data-Key");
        //const dataForm = JSON.parse(document.getElementById("dataClient").getAttribute("data-Clientes"));
        const dataForm = window.clientsData;
        var dataSuggest = [];
        for (i = 0; i < dataForm.length; i++) {
            //if (typeof dataForm[i][keyName] === 'string') {
            dataSuggest.push({ label: dataForm[i][keyName], idx: i })
            //} else {
            //    dataSuggest.push({ label: JSON.stringify(dataForm[i][keyName]), idx: i });
            //}
        }
        //console.log(dataSuggest);
        $(".selector").autocomplete({
            source: dataSuggest
        });
    }

    $(".selector").autocomplete({
        select: function (event, ui) {

            const indice = ui.item.idx;

            const dataForm = window.clientsData;

            $("#clientHelp_c").val(dataForm[indice].idClientes);
        }
    });
</script>

<script src="/js/boostrap-table.js"></script>
<script src="/js/bootstrap-table-filter-control.js"></script>
<script src="/js/displayItineraryMap.js"></script>
<script src="/js/Chart.bundle.js"></script>
<script src="/js/Chart.bundle.min.js"></script>
<script src="/js/chartReports.js"></script>
<script src="/js/saleReports.js"></script>